# Модуль уведомлений

## Описание

Модуль для управления системными уведомлениями пользователей. Администраторы могут отправлять уведомления всем пользователям или конкретному пользователю. Пользователи могут просматривать, помечать как прочитанные и удалять свои уведомления.

## Как это работает

### Для пользователей:

1. **Получение уведомлений**: Пользователь получает список всех своих уведомлений через `GET /api/notifications`
2. **Просмотр**: Уведомления отображаются в модальном окне при клике на иконку колокольчика в хедере
3. **Пометка как прочитанное**: При клике на непрочитанное уведомление оно автоматически помечается как прочитанное через `PATCH /api/notifications/:id/read`
4. **Удаление**: Пользователь может удалить уведомление через `DELETE /api/notifications/:id`
5. **Индикатор**: Красный кружок с количеством непрочитанных уведомлений отображается на иконке колокольчика
6. **Анимация**: Колокольчик анимируется при наличии непрочитанных уведомлений

### Для администраторов:

1. **Создание уведомления**: Администратор может создать уведомление через `POST /api/notifications`
   - Если указан `user_id` - уведомление отправляется конкретному пользователю
   - Если `user_id` не указан - уведомление отправляется всем пользователям
2. **Типы уведомлений**: `info`, `success`, `warning`, `error`
3. **Права доступа**: Только пользователи с `is_admin: true` могут создавать уведомления

## API Endpoints

### `GET /api/notifications`
Получить все уведомления текущего пользователя
- **Требует авторизации**: Да
- **Ответ**: Массив уведомлений

### `POST /api/notifications`
Создать уведомление (только для админов)
- **Требует авторизации**: Да
- **Требует прав админа**: Да
- **Тело запроса**:
  ```json
  {
    "title": "Заголовок",
    "message": "Сообщение",
    "type": "info", // опционально: info, success, warning, error
    "user_id": "uuid" // опционально, если не указан - отправляется всем
  }
  ```

### `PATCH /api/notifications/:id/read`
Пометить уведомление как прочитанное
- **Требует авторизации**: Да
- **Ответ**: `{ id: string, is_read: boolean }`

### `DELETE /api/notifications/:id`
Удалить уведомление
- **Требует авторизации**: Да
- **Ответ**: `{ success: true }`

## Модель данных

```prisma
model Notification {
  id         String    @id @default(uuid())
  user_id    String?
  title      String
  message    String
  type       String    @default("info")
  is_read    Boolean   @default(false)
  created_at DateTime  @default(now())
  updated_at DateTime  @updatedAt
}
```

## Структура уведомления

```typescript
{
  id: string
  title: string
  message: string
  type: 'info' | 'success' | 'warning' | 'error'
  is_read: boolean
  time: string // относительное время (например, "2 минуты назад")
  created_at: string
}
```

## Примеры использования

### Отправка уведомления всем пользователям (админ)
```bash
POST /api/notifications
Authorization: Bearer <admin_token>
{
  "title": "Обновление системы",
  "message": "Запланировано техническое обслуживание завтра с 2:00 до 4:00",
  "type": "warning"
}
```

### Отправка уведомления конкретному пользователю (админ)
```bash
POST /api/notifications
Authorization: Bearer <admin_token>
{
  "title": "Новое достижение",
  "message": "Вы получили достижение 'Первые шаги'",
  "type": "success",
  "user_id": "123e4567-e89b-12d3-a456-426614174000"
}
```

### Получение уведомлений пользователя
```bash
GET /api/notifications
Authorization: Bearer <user_token>
```

## Важные замечания

- Уведомления физически удаляются из БД при удалении пользователем
- Администратор не видит историю отправленных уведомлений после их удаления пользователями
- Для сохранения истории рекомендуется использовать soft delete (добавить поле `deleted_at`)
